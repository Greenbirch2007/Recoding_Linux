
第２４章　　　编写简单的脚本实用工具


本章内容


自动备份
管理用户账户
监测磁盘空间


linux系统管理员每天都会有各种各样的任务，从监测磁盘空间到备份重要文件再到管理用户账户。


２４．１　归档

最好是定时进行备份(或归档)

下面是是两种使用shell脚本备份linux系统数据的方法


一、归档数据文件

如果你正在用linux系统作为一个重要项目的平台，可以创建一个shell脚本来自动获取特定目录的快照。
在配置文件中指定所涉及的目录，这样一来，在项目发送变化时，你就可以做出对应的修改。
这有助于避免把时间耗在恢复主归档文件上。


本节会介绍如何创建自动化shell脚本来获取指定目录的快照并保留旧数据的归档

１．需要的功能


linux中归档数据的主要工具是tar命令。tar命令可以将整个目录归档到单个文件中。　　
下面的例子是用tar命令来创建工作目录归档文件


tar -cf archive.tar /home/lk/*.*

tar命令会显示一条警告消息，表明它删除了路径名开头的斜线，将路径从绝对路径名
变成相对路径名。
这样就可以将tar归档文件解压到文件系统中的任何地方了。这种情况可以通过
将STDERR重定向到/dev/null文件实现


tar -zcf archive.tar.gz  /home/lk/*.*　２>/dev/null

上面已经完成了归档脚本的主要部分

你不需要为待备份的新目录或文件修改或编写新的归档脚本，而是可以借助与配置文件。

配置文件应该包含你希望进行归档的每个目录或文件


可以让脚本读取配置文件，然后将每个目录名加到归档列表中。要实现这一点，只需要使用read命令来读取
该文件中的每一条记录就行了。
不用通过管道将cat命令的输出传给while循环，在这个脚本中我们使用exec命令
来重定向标准输入(STDIN)

exec < $CONFIG_FILE
read FILE_NAME


2. 创建逐日归档文件的存放位置。

创建好集中归档目录后，你需要授予某些用户访问权限。

可以通过sudo命令或创建一个用户组的方式，为需要在集中归档目录中创建文件的用户授权。


３．　创建按日归档的脚本
４．运行按日归档的脚本

在测试脚本之前，要修改脚本文件的权限。必须赋予文件属主可执行权限(x)才能够运行脚本
５．　创建按小时归档的脚本
６．　运行按小时归档的脚本

２４．２　管理用户账户

管理用户账户不仅是添加，修改和删除账户，还要考虑安全问题，保留工作的需求以及对账户的
精确管理。

２４．２．１　需要的功能


删除账户在管理账户工作中比较复杂。在删除账户时，至少需要４个步骤：

（１）　获得正确的待删除用户账户名
（２）　杀死正在系统上运行的属于该账户的进程；
（３）　确认系统中属于该账户的所有文件；
（４）　删除该用户账户

２４．３　监测磁盘空间



