

本章内容

管理进程
获取磁盘统计信息
挂载新磁盘
排序数据
归档数据

4.1 监测程序

linux系统管理员的最复杂的任务之一就是跟踪运行咋系统中的程序

4.1.1 探查进程

当程序运行在系统上时，称之为进程(process)
ps 可以输出咋系统上的所有程序的信息
ps命令只会显示运行在当前控制台下的属于当前用户的进程


linux系统中使用的GUNU ps命令支持3种不同类型的命令行参数

1.Unix风格的参数
2.BSD风格的参数
3.GNU风格的长参数，前面加双破折线

4.1.2  实时监测进程

top 

默认情况下，top命令在启动时会按照%CPU值对进程排序。可以在top运行时使用多种交互命令重新排序
4.1.3 结束进程


1.kill 命令

要发送进程信号，你必须是进程的属主或登录为root用户

TERM信号告诉进程可能的话就停止运行。

强制停止，  -s参数支持指定其他信号(用信号名或信号值)

kill -s HUP  3940

要检查kill命令是否有效，可再运行ps或top命令，看看问题进程是否已经停止


2. killall命令  

killall 支持通过进程名而不是PID来结束进程
killall 命令也支持通过通配符，

killall http*

上面命令结束了所有以http开头的进程，比如Apache Web服务器的httpd服务


警告
以root用户身份登录系统时，使用killall要特别小心，因为很容易就会误用通配符而结束
了重要的系统进程


4.2 监测磁盘空间

系统管理员的另一个重要任务就是监测系统磁盘的使用情况。不管运行的是简单的linux台式机
还是大型的linux服务器

在linux系统上有几个命令行命令可以用来帮助管理存储媒体

4.2.1  挂载存储媒体


linux文件系统将所有的磁盘都并入一个虚拟目录下。在使用新的存储媒体之前，需要把
它放到虚拟目录下。这项工作称为挂载(mounting)

在今天的图形化桌面环境里，大多数linux发行版都能自动挂载特定类型的可移动存储媒体


1. mount 命令

linux上用来挂载媒体的命令叫做mount .默认情况下，mount命令会输出当前系统上挂载的设备列表


2.  umount命令


从linux系统上移除一个可移动设备时，不能直接从系统上移除，而应该先卸载

卸载设备的命令是 umount

umount [directoru | device ]

umount 命令支持通过设备文件或是挂载点来指定要卸载的设备。如果有任何程序正在使用
设备上的文件，系统就不会允许你卸载它


4.2.2  使用df命令

有时要知道在某个设备上还有多少磁盘空间。df命令可以让你方便查看所有已挂载磁盘的使用情况

df命令会显示每个有数据的已挂载文件系统，有些已挂载设备仅限系统内部使用。

-h  会输出的磁盘空间按照用户易读的形式显示，M代表兆字节等


说明


linux系统后台一直有进程来处理文件或使用文件。df命令的输出值显示的是linux系统认为的
当前值。有可能系统上有运行的进程已经创建或删除了某个文件，但尚未释放文件。

4.2.3  使用du命令

通过df命令发现哪个磁盘的存储空间快没了。

使用du命令可以显示某个特定目录(默认情况下是当前面目录)的磁盘使用清理。
这一方法可用来快速判断系统上某个目录下是不是有超大文件。

默认情况下，du命令会显示当前目录下所有文件,目录和子目录的磁盘使用情况，它会以磁盘块
为单位来表明每个文件或目录栈占用了多大存储空间。

-c 总文件大小
-h 换算易读的大小格式


系统管理员接下来就是要使用一些文件处理命令操作大批量的数据

4.3  处理数据文件


4.3.1  排序数据

sort

默认情况下，sort命令按照会话指定的默认语言的排序规则对文本文件中的数据进行排序

-n  会把数字识别成数字而不是字符，并且按值排序

-M 按月排序。linux的日志文件经常会在每行的起始位置有一个时间戳，用来表明时间是什么
时候发生的

-k和-t参数在对按字段分隔的数据进行排序时非常有用

sort -t ":" -k 3 -n /etc/passwd

数据会按照第三个字段---用户ID的数值排序

-n 参数在排序数值时很有用


注意， -r参数将结果按降序输出，这样就更容易看到目录中的哪些文件占用空间最多

du -sh | sort -nr

管道命令(|)将du命令的输出重定向到sort命令


4.3.2  搜索数据

grep [options] pattern [file]

grep命令会在输入或指定的文件中查找包含匹配指定模式的字符的行。

grep 的输出就是包含了匹配模式的行

-v参数： 如果要进行反向搜索(输出不匹配该模式的行)
-n :可以显示匹配模式的行所在的行号
-c : 只要知道有多少行含有匹配的某事
如果要指定多个匹配模式，可用-e参数来指定每个某事

grep -e t -e f


默认情况下，grep命令用基本的Unix风格正则表达式来匹配模式。
Unix风格正则表达式来用特殊字符来定义怎样查找匹配的模式

正则表达式中的方括号用grep应该搜索包含t或f字符的匹配。如果不用正则表达式，
grep就会搜索匹配字符串tf的文本。

4.3.3 压缩数据


gzip:用来压缩文件
gzcat:用来查看压缩过的文本文件的内容
gunzip:用来解压文件

gzip命令会压缩你在命令行指定的文件。也可以在命令行指定多个文件名甚至用通配符来一次性
批量压缩文件

gzip命令会有所该目录章匹配通配符的每个文件

4.3.4  归档数据

tar

创建一个归档文件

tar -cvf tt.tar  test/  test2/

列出test.tar中的内容(包含test和test2目录内容)

tar -tf tt.tar


tar -xvf tt.tar

通过这一命令从tar文件tt.tar中提取内容。如果tar文件是从一个目录结构创建的，那整个
目录结构都会在当前目录下重新创建
tar命令是给整个目录结构创建归档文件的简便方法。


解压文件

tar -zxvf filename.tgz